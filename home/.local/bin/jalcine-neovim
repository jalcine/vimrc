#!/usr/bin/env bash
# vim: set fdm=marker :
# TODO: Import shared framework for my shell scripts from `dotfiles`.
# TODO: Add more option control to this.
# TODO: Merge update + install scripts.

cd "${HOME}/.config/nvim" || exit

NEEDED_SUBDIRS=(logs tags)

for subdir in "${NEEDED_SUBDIRS}"; do
  mkdir -p "${HOME}/.config/nvim/${subdir}" || exit
done

pyenv virtualenv 2.7.13 neovim-py2 -vf
pyenv virtualenv 3.6.2 neovim-py3 -vf

# Install language dependencies. {{{
RB_REQS="${HOME}/.config/nvim/Gemfile"
JS_REQS="${HOME}/.config/nvim/npm.list"

# Handle Python {{{
pyenv exec pip3 install pip-tools
pyenv exec pip2 install pip-tools

pyenv local neovim-py3 neovim-py2
# }}}

# {{{ Extra language support
if [ "$JALCINE_NEOVIM_MINIMAL" ]
then
  exit
elses
  bundle install --gemfile="${RB_REQS}"
  # shellcheck disable=SC2046,SC2086
  npm install -g $(cat $JS_REQS)
  cpanm Perl::Tidy
  exenv install $(exenv local)
  cd ~/.config/nvim/plugins/elixir-ls || exit "'elixir-ls' not installed."
  mix "do" deps.get, deps.compile, compile
  cd - || exit "Can't go back."

fi
# }}}
