#!/usr/bin/env bash
# vim: set fdm=marker :
# TODO: Import shared framework for my shell scripts from `dotfiles`.
# TODO: Add more option control to this.
# TODO: Merge update + install scripts.

cd "${HOME}/.config/nvim"
pyenv virtualenv 2.7.12 neovim-py2 -v
pyenv virtualenv 3.5.2 neovim-py3 -v

# Install language dependencies. {{{
RB_REQS="${HOME}/.config/nvim/Gemfile"
JS_REQS="${HOME}/.config/nvim/npm.list"

# Handle Python {{{
pyenv local neovim-py3 && pyenv rehash
pyenv exec pip3 install pip-tools
pyenv exec pip-sync requirements-py3.txt

pyenv local neovim-py2 && pyenv rehash
pyenv exec pip install pip-tools
pyenv exec pip-sync requirements-py2.txt

pyenv local neovim-py3 neovim-py2
nvim +"call plugins#install()" +qall
# }}}

# {{{ Extra language support
if [ "$JALCINE_NEOVIM_MINIMAL" ]
then
  exit
else
  bundle install --gemfile="${RB_REQS}"
  npm install -g $(cat ${JS_REQS} | xargs)
  cpanm Perl::Tidy
  [ -x racer ] && cargo uninstall racer
  cargo install racer
fi
# }}}
