#!/usr/bin/env bash

cd "${HOME}/.config/nvim" || exit


PY_REQS="${HOME}/.config/nvim/requirements.in"
PY3_REQS="${HOME}/.config/nvim/requirements-py3.in"
JS_REQS="${HOME}/.config/nvim/npm.list"

pyenv local neovim-py3 && pyenv rehash
pyenv exec pip-compile "${PY3_REQS}" --output-file requirements-py3.txt

pyenv local neovim-py2 && pyenv rehash
pyenv exec pip-compile "${PY_REQS}" --output-file requirements-py2.txt
pyenv local neovim-py3 neovim-py2

nvim +"call jalcine#plugins#update()" +qall

if [ "$JALCINE_NEOVIM_MINIMAL" ]
then
  exit
else
  bundle update
  # shellcheck disable=SC2046,SC2086
  npm install -g $(cat $JS_REQS)
fi
